# FesFolio Event JSON Maker

イベントのタイムテーブルJSONを簡単に作成できるWebベースのツールです。完全オフラインで動作し、ブラウザだけで利用できます。

## 🎯 概要

- **完全オフライン動作**: インターネット接続不要
- **手動入力モード**: GUIで直感的にデータ入力
- **一括入力モード**: OCR等で取得したテキストから一括作成
- **リアルタイムプレビュー**: 入力内容をその場で確認
- **スキーマ準拠**: FesFolio標準スキーマに完全対応

## 🚀 使い方

### 起動方法

1. **ブラウザで開く**
   ```
   maker/timetable_json_tool.html をブラウザで開く
   ```

2. **推奨環境**
   - Chrome / Edge / Firefox の最新版
   - JavaScriptが有効になっていること

### 基本的な入力手順

#### 1. 基本情報の入力（必須）

| 項目 | 説明 | 例 |
|------|------|-----|
| **イベント名** | イベントの正式名称 | `2025アイドル年末フェス` |
| **開催日** | YYYY-MM-DD形式 | `2025-12-14` |
| **開場** | HH:MM形式 | `12:00` |
| **開演** | HH:MM形式（開場時刻から自動計算） | `12:30` |
| **会場名** | 会場の名称 | `SAMPLE HALL` |

#### 2. オプション情報の入力（任意）

- **公式URL**: イベントの公式サイト
- **チケットURL**: チケット購入ページ
- **説明**: イベントの詳細説明

#### 3. ステージ情報の設定

1. 「+ ステージ追加」ボタンでステージを追加
2. 各ステージに以下を入力:
   - **ステージID**: 半角英数字・ハイフン（例: `stage-a`, `hall1`）
   - **ステージ名**: 表示名（例: `Aステージ`, `メインホール`）
   - **説明**: ステージの補足情報（任意）

💡 **ヒント**: ステージは最低1つ必要です

#### 4. タイムテーブルの入力

##### 手動入力モード

1. デフォルト設定で効率アップ:
   - **ステージ**: よく使うステージを選択
   - **タイプ**: ライブ/特典会/物販/その他
   - **時間間隔**: 次の枠の開始時刻を自動計算（分単位）

2. 各枠の情報を入力:
   - **ステージ**: 対象ステージを選択
   - **開始時刻**: HH:MM形式（前の枠から自動計算可）
   - **終了時刻**: HH:MM形式（自動計算可）
   - **出演者**: アーティスト名やグループ名
   - **タイプ**: 枠の種類
   - **詳細**: 補足情報（任意）
   - **絵文字**: 枠のアイコン（任意）

3. 「+ 枠を追加」で次の枠へ

##### 一括入力モード（OCR対応）

OCRや他のツールで取得したテキストから一括作成できます。

**入力形式（タブ区切り）:**
```
ステージID	開始	終了	出演者	タイプ	詳細	絵文字
stage-a	13:00	13:20	サンプルアイドル	live		🎤
stage-a	13:25	13:45	テストグループ	live		
stage-b	13:00	14:00	グッズ販売	goods		🛍️
```

**対応するタイプ:**
- `live` または `ライブ`: ライブパフォーマンス
- `tokuten` または `特典会`: 特典会・握手会等
- `goods` または `物販`: グッズ販売
- `other` または `その他`: その他のイベント

**使い方:**
1. テキストエリアにタブ区切りデータを貼り付け
2. 「TSVを読み込む」ボタンをクリック
3. 内容を確認して必要に応じて修正

💡 **ヒント**: 
- Excel等でタイムテーブルを作成し、コピー＆ペーストが便利
- OCRで読み取った画像データも整形して利用可能

### JSONの生成とダウンロード

1. **リアルタイムプレビュー**
   - 画面下部の「JSON出力プレビュー」で生成内容を確認
   - 入力内容が自動的にJSONに反映されます

2. **JSONダウンロード**
   - 「JSONをダウンロード」ボタンをクリック
   - ファイル名は `YYYY-MM-DD_カテゴリ_スラッグ.json` 形式で自動生成
   - カテゴリとスラッグは手動で設定

3. **検証**
   - 必須項目が未入力の場合は警告が表示されます
   - ステージIDの重複や参照エラーも自動チェック

## 📂 ファイル構成

```
maker/
├── timetable_json_tool.html    # メインHTML（ツール本体）
├── app.js                       # ロジック（データ処理・JSON生成）
├── style.css                    # スタイルシート（デザイン）
├── flatpickr.min.css           # Flatpickrライブラリ（ローカル）
├── flatpickr-custom.css        # Flatpickrカスタムスタイル
└── README.md                    # このファイル
```

## 🔧 技術仕様

### 使用ライブラリ

- **Flatpickr**: 日付・時刻ピッカー
  - CDN: `https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.js`
  - 日本語ロケール対応

### 生成されるJSON形式

FesFolio標準スキーマ（`schemas/event.schema.json`）に準拠したJSONを生成します。

**基本構造:**
```json
{
  "event_id": "2025-12-14_i_sample-event",
  "event_name": "サンプルイベント",
  "date": "2025-12-14",
  "open_time": "12:00",
  "start_time": "12:30",
  "venue": "サンプルホール",
  "official_url": "https://example.com",
  "ticket_url": "https://example.com/ticket",
  "description": "説明文",
  "stages": [
    {
      "stage_id": "stage-a",
      "stage_name": "Aステージ",
      "description": "メインステージ"
    }
  ],
  "timetable": [
    {
      "stage_id": "stage-a",
      "start": "13:00",
      "end": "13:20",
      "act": "サンプルアイドル",
      "type": "live",
      "description": "1stライブ",
      "emoji": "🎤"
    }
  ]
}
```

### ファイル命名規則

ダウンロードされるファイル名は以下の形式:

```
YYYY-MM-DD_カテゴリ_スラッグ.json
```

- **YYYY-MM-DD**: 開催日
- **カテゴリ**: 
  - `i`: アイドル
  - `r`: ロック
  - `e`: EDM
  - `o`: その他
- **スラッグ**: イベント名を英数字・ハイフンで表現

**例:** `2025-12-14_i_hype-idol.json`

## 💡 使用例

### ケース1: 小規模イベント（単一ステージ）

1. イベント名: `地下アイドルフェス2025`
2. 開催日: `2025-12-14`
3. ステージ: 1つ（`main-stage`）
4. タイムテーブル: 5組、各20分

**所要時間:** 約5分

### ケース2: 大規模フェス（複数ステージ）

1. イベント名: `IDOL FESTIVAL 2025`
2. 開催日: `2025-08-15`
3. ステージ: 3つ（A, B, Cステージ）
4. タイムテーブル: 30組、各15-30分

**推奨方法:**
- 一括入力モードでExcelから貼り付け
- ステージごとにソート済みデータを用意

**所要時間:** 約15分

### ケース3: OCRからの変換

1. タイムテーブル画像をOCRで読み取り
2. 結果をExcelで整形
3. タブ区切りテキストとしてコピー
4. 一括入力モードに貼り付け
5. 手動で微調整

**所要時間:** 約10分（OCR時間除く）

## ⚠️ トラブルシューティング

### ダウンロードボタンが押せない

- 必須項目（イベント名、開催日、開場、開演、会場）が入力されているか確認
- ステージが最低1つ作成されているか確認
- タイムテーブルが最低1つ入力されているか確認

### 時刻の自動計算がうまくいかない

- 開場時刻が正しく入力されているか確認（HH:MM形式）
- 時間間隔がデフォルト値として設定されているか確認
- 前の枠の終了時刻が入力されているか確認

### 一括入力でエラーが出る

- タブ区切りになっているか確認（スペース区切りは不可）
- ヘッダー行が正しい順序か確認
- ステージIDがステージ情報で定義されているか確認
- タイプが対応する値か確認（`live`, `tokuten`, `goods`, `other`）

### JSONプレビューが表示されない

- ブラウザの開発者ツール（F12）でエラーを確認
- JavaScriptが有効になっているか確認
- ブラウザのキャッシュをクリアして再読み込み

### ID命名のコツ

**ステージID:**
- 短く分かりやすく: `stage-a`, `hall-1`, `main`
- 半角英数字とハイフンのみ使用
- 会場のフロア図等と対応させると分かりやすい

**event_id（ファイル名）:**
- 開催日を正確に: 複数日開催の場合は初日
- カテゴリを適切に選択
- スラッグは短く、イベント名を想起できるように

## 📝 関連ドキュメント

- [メインREADME](../README.md): プロジェクト全体の説明
- [Viewer README](../viewer/README.md): タイムテーブル表示ツールの説明
- [イベントスキーマ](../schemas/event.schema.json): JSONファイルの仕様
- [サンプルJSON](../sample/sample-event.json): JSONファイルの記述例

## ❓ FAQ

**Q: オフラインで使えますか？**  
A: はい。すべての機能がブラウザ内で完結します。Flatpickrライブラリだけはオンライン時にCDNから読み込まれますが、ローカルにダウンロードすることも可能です。

**Q: 作成したJSONはどこに保存されますか？**  
A: ダウンロードボタンを押すと、ブラウザのダウンロードフォルダに保存されます。

**Q: 既存のJSONファイルを編集できますか？**  
A: 現在のバージョンでは新規作成のみ対応しています。

**Q: タイムテーブルの枠数に制限はありますか？**  
A: 技術的な制限はありませんが、表示パフォーマンスを考慮すると1イベント100枠程度までを推奨します。

**Q: 複数日程のイベントはどう扱いますか？**  
A: 日ごとに別のJSONファイルとして作成してください。ファイル名の日付で区別します。
